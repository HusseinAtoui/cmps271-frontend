<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep existing styles -->
    <style>
        /* Add to existing styles */
        .guidelines-error {
            background-color: #fff3f3;
            border: 2px solid #ff6b6b;
            color: #cc0000;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Comment Compliance Checker</h1>
        
        <textarea 
            id="inputText" 
            placeholder="Enter your comment..."
        ></textarea>
        
        <button onclick="checkGuidelinesCompliance()">Check Compliance</button>
        
        <div id="result" class="result"></div>
        <div id="error" class="error"></div>
        <div id="guidelinesWarning" class="guidelines-error" style="display: none;">
            ⚠️ This comment doesn't align with our community guidelines
        </div>
    </div>

    <script>
        const GUIDELINES_THRESHOLD = 0.7; // 70% confidence threshold

        async function checkGuidelinesCompliance() {
            const inputText = document.getElementById('inputText').value.trim();
            const resultDiv = document.getElementById('result');
            const errorDiv = document.getElementById('error');
            const warningDiv = document.getElementById('guidelinesWarning');

            // Clear previous messages
            resultDiv.innerHTML = '';
            errorDiv.innerHTML = '';
            warningDiv.style.display = 'none';

            if (!inputText) {
                showError('Please enter a comment to check');
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/sentimentComments/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ text: inputText })
                });

                if (!response.ok) throw new Error('Analysis failed');
                const data = await response.json();

                const sentimentMap = {
                    'anger': 'negative',
                    'disgust': 'negative',
                    'fear': 'negative',
                    'sadness': 'negative',
                    'joy': 'positive',
                    'neutral': 'neutral',
                    'surprise': 'neutral'
                };

                const generalSentiment = sentimentMap[data.emotion.toLowerCase()] || 'neutral';
                const isNegative = generalSentiment === 'negative' && data.confidence > GUIDELINES_THRESHOLD;

                if (isNegative) {
                    warningDiv.style.display = 'block';
                    resultDiv.style.display = 'none';
                } else {
                    resultDiv.className = `result ${generalSentiment}`;
                    resultDiv.innerHTML = `
                        <strong>Status:</strong> Approved for posting<br>
                        <strong>Detected Emotion:</strong> ${data.emotion}<br>
                        <strong>Confidence:</strong> ${(data.confidence * 100).toFixed(1)}%
                    `;
                    resultDiv.style.display = 'block';
                    warningDiv.style.display = 'none';
                }

            } catch (error) {
                showError(`Compliance check failed: ${error.message}`);
                console.error('Error:', error);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = message;
        }
    </script>
</body>
</html>